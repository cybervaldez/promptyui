<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Move to Theme Modal — Preview</title>
<style>
/* ── Design Tokens (from PromptyUI styles.css) ── */
:root {
    --pu-bg-primary: #191919;
    --pu-bg-secondary: #202020;
    --pu-bg-tertiary: #2f2f2f;
    --pu-bg-input: #252525;
    --pu-bg-hover: rgba(255, 255, 255, 0.04);
    --pu-bg-selected: rgba(255, 255, 255, 0.06);
    --pu-bg-elevated: #252525;
    --pu-bg-overlay: rgba(0, 0, 0, 0.5);

    --pu-text-primary: #ebebeb;
    --pu-text-secondary: #999999;
    --pu-text-muted: #7a7a7a;

    --pu-accent: #529CCA;
    --pu-accent-bg: rgba(82, 156, 202, 0.08);
    --pu-accent-light: rgba(82, 156, 202, 0.12);
    --pu-accent-border: rgba(82, 156, 202, 0.25);
    --pu-accent-muted: rgba(82, 156, 202, 0.5);
    --pu-success: #4daa57;
    --pu-success-bg: rgba(77, 170, 87, 0.12);
    --pu-warning: #cb912f;
    --pu-warning-bg: rgba(203, 145, 47, 0.1);
    --pu-error: #e06c75;
    --pu-error-bg: rgba(224, 108, 117, 0.1);
    --pu-purple: #c678dd;
    --pu-purple-bg: rgba(198, 120, 221, 0.1);

    --pu-border: rgba(255, 255, 255, 0.06);
    --pu-border-light: rgba(255, 255, 255, 0.09);

    --pu-radius-sm: 3px;
    --pu-radius: 4px;
    --pu-radius-lg: 6px;

    --pu-font-body: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    --pu-font-mono: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
    --pu-font-size-2xs: 10px;
    --pu-font-size-xs: 11px;
    --pu-font-size-sm: 12px;
    --pu-font-size-md: 13px;
    --pu-font-size-base: 14px;
    --pu-font-size-lg: 16px;

    --pu-space-xs: 4px;
    --pu-space-sm: 8px;
    --pu-space-md: 12px;
    --pu-space-lg: 16px;
    --pu-space-xl: 24px;

    --pu-transition-fast: 120ms ease-out;
    --pu-transition-normal: 200ms ease-out;

    --pu-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    --pu-shadow-lg: 0 6px 20px rgba(0, 0, 0, 0.4);
}

* { box-sizing: border-box; }

body {
    margin: 0;
    padding: 0;
    font-family: var(--pu-font-body);
    font-size: var(--pu-font-size-base);
    line-height: 1.5;
    background: var(--pu-bg-primary);
    color: var(--pu-text-primary);
}

/* ── Scenario Switcher ── */
.preview-controls {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 3000;
    background: var(--pu-bg-secondary);
    border-bottom: 1px solid var(--pu-border-light);
    padding: var(--pu-space-sm) var(--pu-space-lg);
    display: flex;
    align-items: center;
    gap: var(--pu-space-lg);
    font-size: var(--pu-font-size-sm);
    color: var(--pu-text-secondary);
}
.preview-controls label { cursor: pointer; }
.preview-controls input[type="radio"] { accent-color: var(--pu-accent); }
.preview-label {
    font-family: var(--pu-font-mono);
    color: var(--pu-accent);
    font-size: var(--pu-font-size-xs);
    background: var(--pu-accent-bg);
    padding: 2px 6px;
    border-radius: var(--pu-radius-sm);
    margin-right: var(--pu-space-sm);
}

/* ── Modal Overlay (exact .pu-modal-overlay) ── */
.pu-modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: var(--pu-bg-overlay);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* ── Modal (exact .pu-modal) ── */
.pu-modal {
    width: 560px;
    max-height: 80vh;
    background: var(--pu-bg-elevated);
    border: 1px solid var(--pu-border);
    border-radius: var(--pu-radius-lg);
    box-shadow: var(--pu-shadow-lg);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.pu-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--pu-space-lg) 20px;
    background: var(--pu-bg-hover);
    border-radius: var(--pu-radius-lg) var(--pu-radius-lg) 0 0;
}
.pu-modal-header h2 {
    margin: 0;
    font-size: 18px;
    font-weight: 500;
}
.pu-modal-close {
    background: none;
    border: none;
    color: var(--pu-text-muted);
    font-size: 24px;
    cursor: pointer;
    transition: color var(--pu-transition-fast);
    line-height: 1;
}
.pu-modal-close:hover { color: var(--pu-text-primary); }

.pu-modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}

.pu-modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--pu-space-sm);
    padding: var(--pu-space-lg) 20px;
    border-top: 1px solid var(--pu-border);
}

/* ── Buttons (exact .pu-btn / .pu-btn-primary) ── */
.pu-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: var(--pu-space-sm) var(--pu-space-lg);
    background: var(--pu-bg-hover);
    border: 1px solid var(--pu-border);
    border-radius: var(--pu-radius);
    color: var(--pu-text-primary);
    font-family: var(--pu-font-body);
    font-size: var(--pu-font-size-md);
    cursor: pointer;
    transition: all var(--pu-transition-fast);
}
.pu-btn:hover {
    background: var(--pu-bg-selected);
    border-color: var(--pu-border-light);
}
.pu-btn-primary {
    background: var(--pu-accent-bg);
    border-color: var(--pu-accent-border);
    color: var(--pu-accent);
}
.pu-btn-primary:hover {
    background: rgba(82, 156, 202, 0.18);
    border-color: var(--pu-accent-muted);
}
.pu-btn:disabled {
    opacity: 0.4;
    cursor: default;
    pointer-events: none;
}

/* ── Radio (exact .pu-radio) ── */
.pu-radio {
    display: flex;
    align-items: center;
    gap: var(--pu-space-sm);
    cursor: pointer;
    font-size: var(--pu-font-size-md);
}
.pu-radio input { accent-color: var(--pu-accent); }

/* ── Validation item (exact .pu-export-validation-item) ── */
.pu-export-validation-item {
    display: flex;
    align-items: flex-start;
    gap: var(--pu-space-sm);
    padding: 10px var(--pu-space-md);
    border-radius: var(--pu-radius);
    margin-bottom: var(--pu-space-xs);
    font-size: var(--pu-font-size-sm);
}
.pu-export-validation-item.warning {
    background: var(--pu-warning-bg);
    color: var(--pu-warning);
}

/* ── Toast (exact .pu-toast) ── */
.pu-toast-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 3000;
}
.pu-toast {
    padding: var(--pu-space-md) 20px;
    background: var(--pu-bg-elevated);
    border: 1px solid var(--pu-border);
    border-radius: var(--pu-radius);
    box-shadow: var(--pu-shadow);
    margin-top: var(--pu-space-sm);
    font-size: var(--pu-font-size-sm);
    animation: pu-toast-in 0.3s ease;
}
.pu-toast.success { border-color: var(--pu-success); color: var(--pu-success); }
.pu-toast.error { border-color: var(--pu-error); color: var(--pu-error); }
@keyframes pu-toast-in {
    0% { opacity: 0; transform: translateX(20px); }
    100% { opacity: 1; transform: translateX(0); }
}

/* ═══════════════════════════════════════════
   MOVE-TO-THEME SPECIFIC STYLES
   ═══════════════════════════════════════════ */

/* ── Section labels ── */
.pu-mtt-section-label {
    display: block;
    margin-bottom: 6px;
    font-size: var(--pu-font-size-sm);
    color: var(--pu-text-secondary);
    font-weight: 500;
}

/* ── Block preview ── */
.pu-mtt-preview {
    margin-bottom: var(--pu-space-lg);
    padding: var(--pu-space-md);
    background: var(--pu-bg-tertiary);
    border-radius: var(--pu-radius);
    font-size: var(--pu-font-size-sm);
    color: var(--pu-text-secondary);
    line-height: 1.6;
    position: relative;
}
.pu-mtt-preview .pu-wc-highlight {
    color: var(--pu-accent);
    font-weight: 500;
}
.pu-mtt-block-index {
    position: absolute;
    bottom: 6px;
    right: 8px;
    font-size: var(--pu-font-size-2xs);
    color: var(--pu-text-muted);
    font-family: var(--pu-font-mono);
}

/* ── Theme name input ── */
.pu-mtt-input-group {
    margin-bottom: var(--pu-space-lg);
}
.pu-mtt-input-group input[type="text"] {
    display: block;
    width: 100%;
    margin-top: 4px;
    padding: 6px 8px;
    background: var(--pu-bg-input);
    border: 1px solid var(--pu-border-light);
    border-radius: var(--pu-radius);
    color: var(--pu-text-primary);
    font-size: var(--pu-font-size-sm);
    font-family: var(--pu-font-mono);
}
.pu-mtt-input-group input[type="text"]:focus {
    outline: none;
    border-color: var(--pu-accent);
    box-shadow: 0 0 0 2px var(--pu-accent-bg);
}
.pu-mtt-path-hint {
    margin-top: 4px;
    font-size: var(--pu-font-size-2xs);
    color: var(--pu-text-muted);
    font-family: var(--pu-font-mono);
}

/* ── Scope radios ── */
.pu-mtt-scope {
    display: flex;
    flex-direction: column;
    gap: var(--pu-space-sm);
    margin-bottom: var(--pu-space-lg);
}
.pu-mtt-scope .pu-radio {
    padding: var(--pu-space-sm) var(--pu-space-md);
    border-radius: var(--pu-radius);
    transition: background var(--pu-transition-fast);
}
.pu-mtt-scope .pu-radio:hover {
    background: var(--pu-bg-hover);
}
.pu-mtt-scope .scope-path {
    font-size: var(--pu-font-size-xs);
    color: var(--pu-text-muted);
    font-family: var(--pu-font-mono);
    margin-left: 4px;
}

/* ── Wildcard section ── */
.pu-mtt-wildcards {
    margin-bottom: var(--pu-space-sm);
}
.pu-mtt-wc-toggle {
    display: flex;
    align-items: center;
    gap: var(--pu-space-sm);
    cursor: pointer;
    padding: var(--pu-space-sm) 0;
    font-size: var(--pu-font-size-sm);
    color: var(--pu-text-secondary);
    user-select: none;
}
.pu-mtt-wc-toggle:hover { color: var(--pu-text-primary); }
.pu-mtt-wc-toggle .pu-mtt-chevron {
    font-size: 10px;
    transition: transform var(--pu-transition-fast);
    display: inline-block;
}
.pu-mtt-wc-toggle .pu-mtt-chevron.expanded {
    transform: rotate(90deg);
}
.pu-mtt-wc-summary {
    font-family: var(--pu-font-mono);
    font-size: var(--pu-font-size-xs);
    color: var(--pu-text-muted);
    margin-left: auto;
}

.pu-mtt-wc-list {
    padding-left: 4px;
    margin-top: var(--pu-space-xs);
}
.pu-mtt-wc-item {
    display: flex;
    align-items: center;
    gap: var(--pu-space-sm);
    padding: 5px 0;
    font-size: var(--pu-font-size-sm);
}
.pu-mtt-wc-item input[type="checkbox"] {
    margin: 0;
    cursor: pointer;
    accent-color: var(--pu-accent);
    width: 13px;
    height: 13px;
}
.pu-mtt-wc-item label {
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
}
.pu-mtt-wc-name {
    font-family: var(--pu-font-mono);
    color: var(--pu-text-primary);
}
.pu-mtt-wc-count {
    color: var(--pu-text-muted);
    font-size: var(--pu-font-size-xs);
}
.pu-mtt-wc-shared {
    font-size: var(--pu-font-size-xs);
    color: var(--pu-warning);
    margin-left: 4px;
}

/* ── Trigger button (in block right-edge) ── */
.pu-inline-action.pu-inline-move {
    color: var(--pu-text-muted);
    background: none;
    border: none;
    cursor: pointer;
    padding: 2px;
    display: flex;
    align-items: center;
    transition: color var(--pu-transition-fast);
}
.pu-inline-action.pu-inline-move:hover {
    color: var(--pu-accent);
}

/* ── Block mockup for context ── */
.block-context {
    margin: 80px auto 40px;
    max-width: 600px;
    padding: var(--pu-space-lg);
}
.block-context-title {
    font-size: var(--pu-font-size-xs);
    color: var(--pu-text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: var(--pu-space-sm);
}

/* Mock block to show trigger button placement */
.mock-block {
    background: var(--pu-bg-secondary);
    border: 1px solid var(--pu-border);
    border-radius: var(--pu-radius);
    padding: var(--pu-space-md) var(--pu-space-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--pu-space-sm);
}
.mock-block-text {
    font-size: var(--pu-font-size-sm);
    color: var(--pu-text-secondary);
    flex: 1;
}
.mock-block-text .pu-wc-highlight {
    color: var(--pu-accent);
    font-weight: 500;
}
.mock-block-actions {
    display: flex;
    gap: 4px;
    align-items: center;
    flex-shrink: 0;
    margin-left: var(--pu-space-md);
}
.mock-block.is-ext {
    border-left: 3px solid var(--pu-purple);
}
.mock-block.is-ext .mock-ext-badge {
    font-family: var(--pu-font-mono);
    font-size: var(--pu-font-size-xs);
    color: var(--pu-purple);
    background: var(--pu-purple-bg);
    padding: 1px 6px;
    border-radius: var(--pu-radius-sm);
    margin-right: var(--pu-space-sm);
}
.mock-block.has-children {
    opacity: 0.5;
}
.mock-block.has-children .mock-block-actions {
    visibility: hidden;
}
.mock-disabled-hint {
    font-size: var(--pu-font-size-2xs);
    color: var(--pu-text-muted);
    padding-left: var(--pu-space-lg);
    margin-top: -4px;
    margin-bottom: var(--pu-space-sm);
}

/* ── SVG icons ── */
.pu-inline-action svg {
    width: 14px;
    height: 14px;
}
.mock-block-actions .pu-inline-action svg {
    width: 14px;
    height: 14px;
}
</style>
</head>
<body>

<!-- ── Scenario Switcher ── -->
<div class="preview-controls">
    <span class="preview-label">PREVIEW</span>
    <label><input type="radio" name="scenario" value="happy" checked onchange="switchScenario('happy')"> Happy path (exclusive wildcards)</label>
    <label><input type="radio" name="scenario" value="shared" onchange="switchScenario('shared')"> Shared wildcard warning</label>
    <label><input type="radio" name="scenario" value="no-wc" onchange="switchScenario('no-wc')"> No wildcards</label>
    <label><input type="radio" name="scenario" value="toast" onchange="switchScenario('toast')"> Post-move toast</label>
</div>

<!-- ── Block Context (shows trigger button placement) ── -->
<div class="block-context" id="block-context">
    <div class="block-context-title">Trigger button placement (right-edge actions)</div>

    <!-- Content block — eligible, shows move button -->
    <div class="mock-block" data-testid="mock-block-0">
        <span class="mock-block-text">Write a job posting for a <span class="pu-wc-highlight">__role__</span> position</span>
        <div class="mock-block-actions">
            <!-- Move to Theme trigger -->
            <button class="pu-inline-action pu-inline-move" data-testid="pu-block-move-btn-0" title="Move block to reusable theme" onclick="openModal('happy')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            </button>
            <!-- Edit (existing) -->
            <button class="pu-inline-action pu-inline-edit" title="Edit block">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.83 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
            </button>
            <!-- Delete (existing) -->
            <button class="pu-inline-action pu-inline-delete" title="Delete block">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/></svg>
            </button>
        </div>
    </div>

    <!-- ext_text block — ineligible (already theme) -->
    <div class="mock-block is-ext">
        <span class="mock-ext-badge">hiring/roles</span>
        <span class="mock-block-text" style="color: var(--pu-text-muted); font-size: var(--pu-font-size-xs);">Already a theme reference — no move button</span>
        <div class="mock-block-actions">
            <button class="pu-inline-action pu-inline-edit" title="Edit block">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.83 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
            </button>
        </div>
    </div>

    <!-- Content block with children — ineligible -->
    <div class="mock-block has-children">
        <span class="mock-block-text">You are a <span class="pu-wc-highlight">__tone__</span> HR consultant for a <span class="pu-wc-highlight">__company_size__</span> company</span>
        <div class="mock-block-actions">
            <button class="pu-inline-action pu-inline-move" disabled title="Has nested children — move children first">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            </button>
        </div>
    </div>
    <div class="mock-disabled-hint">Has nested children — move children first</div>
</div>

<!-- ── Modal Overlay ── -->
<div class="pu-modal-overlay" data-testid="pu-move-to-theme-modal" id="modal-overlay" style="display: none;">
    <div class="pu-modal" data-testid="pu-mtt-modal">

        <!-- Header -->
        <div class="pu-modal-header">
            <h2>Move to Theme</h2>
            <button class="pu-modal-close" data-testid="pu-mtt-close-btn" onclick="closeModal()">&times;</button>
        </div>

        <!-- Body -->
        <div class="pu-modal-body" id="modal-body">
            <!-- Populated by JS per scenario -->
        </div>

        <!-- Footer -->
        <div class="pu-modal-footer">
            <button class="pu-btn" data-testid="pu-mtt-cancel-btn" onclick="closeModal()">Cancel</button>
            <button class="pu-btn pu-btn-primary" data-testid="pu-mtt-confirm-btn" id="confirm-btn" onclick="simulateMove()">Move</button>
        </div>

    </div>
</div>

<!-- ── Toast Container ── -->
<div class="pu-toast-container" data-testid="pu-toast-container" id="toast-container"></div>

<script>
// ── Scenario Data ──
const scenarios = {
    happy: {
        blockText: 'Write a job posting for a <span class="pu-wc-highlight">__role__</span> position',
        blockIndex: 0,
        themePrefix: 'hiring/',
        themePlaceholder: 'e.g., hiring/job-postings',
        jobId: 'hiring-templates',
        wildcards: [
            { name: 'role', count: 5, shared: false, checked: true }
        ],
        hasWarnings: false
    },
    shared: {
        blockText: 'You are a <span class="pu-wc-highlight">__tone__</span> HR consultant for a <span class="pu-wc-highlight">__company_size__</span> company',
        blockIndex: 0,
        themePrefix: 'hiring/',
        themePlaceholder: 'e.g., hiring/hr-consultant',
        jobId: 'hiring-templates',
        wildcards: [
            { name: 'tone', count: 3, shared: true, checked: false },
            { name: 'company_size', count: 3, shared: false, checked: true }
        ],
        hasWarnings: true
    },
    'no-wc': {
        blockText: 'Add a summary section at the end',
        blockIndex: 3,
        themePrefix: 'hiring/',
        themePlaceholder: 'e.g., hiring/summary-block',
        jobId: 'hiring-templates',
        wildcards: [],
        hasWarnings: false
    }
};

let currentScenario = 'happy';
let wcExpanded = false;

function switchScenario(name) {
    currentScenario = name;
    if (name === 'toast') {
        closeModal();
        showToast('Moved to ext/hiring/job-postings.yaml', 'success');
        return;
    }
    openModal(name);
}

function openModal(scenario) {
    currentScenario = scenario;
    const data = scenarios[scenario];
    if (!data) return;

    // Auto-expand if warnings, collapse otherwise
    wcExpanded = data.hasWarnings;

    renderModalBody(data);
    document.getElementById('modal-overlay').style.display = 'flex';
}

function closeModal() {
    document.getElementById('modal-overlay').style.display = 'none';
}

function renderModalBody(data) {
    const body = document.getElementById('modal-body');
    let html = '';

    // 1. Preview block
    html += `
        <label class="pu-mtt-section-label">Moving this block:</label>
        <div class="pu-mtt-preview" data-testid="pu-mtt-preview">
            ${data.blockText}
            <span class="pu-mtt-block-index">block ${data.blockIndex}</span>
        </div>
    `;

    // 2. Theme name input
    html += `
        <div class="pu-mtt-input-group">
            <label class="pu-mtt-section-label" for="mtt-theme-name">Theme name</label>
            <input type="text"
                   id="mtt-theme-name"
                   data-testid="pu-mtt-theme-name"
                   value="${data.themePrefix}"
                   placeholder="${data.themePlaceholder}"
                   oninput="updatePathHint()">
            <div class="pu-mtt-path-hint" id="path-hint" data-testid="pu-mtt-path-hint">
                ext/${data.themePrefix}
            </div>
        </div>
    `;

    // 3. Scope radios
    html += `
        <div class="pu-mtt-scope" data-testid="pu-mtt-scope">
            <label class="pu-radio">
                <input type="radio" name="move-scope" value="shared" checked onchange="updatePathHint()">
                Shared
                <span class="scope-path" id="scope-shared-path">ext/<span id="shared-path-val">${data.themePrefix}</span></span>
            </label>
            <label class="pu-radio">
                <input type="radio" name="move-scope" value="fork" onchange="updatePathHint()">
                Job-scoped copy
                <span class="scope-path" id="scope-fork-path">ext/${data.jobId}/<span id="fork-path-val">${data.themePrefix}</span></span>
            </label>
        </div>
    `;

    // 4. Wildcards section (skip if none)
    if (data.wildcards.length > 0) {
        const checkedCount = data.wildcards.filter(w => w.checked).length;
        const names = data.wildcards.filter(w => w.checked).map(w => w.name).join(', ');
        const summaryText = checkedCount > 0
            ? `${checkedCount} bundled (${names})`
            : 'none bundled';

        html += `<div class="pu-mtt-wildcards" data-testid="pu-mtt-wildcards">`;
        html += `
            <div class="pu-mtt-wc-toggle" onclick="toggleWildcards()" data-testid="pu-mtt-wc-toggle">
                <span class="pu-mtt-chevron ${wcExpanded ? 'expanded' : ''}" id="wc-chevron">&#9654;</span>
                <span>Bundled wildcards</span>
                <span class="pu-mtt-wc-summary" id="wc-summary">${summaryText}</span>
            </div>
        `;

        html += `<div class="pu-mtt-wc-list" id="wc-list" style="display: ${wcExpanded ? 'block' : 'none'}">`;
        data.wildcards.forEach((wc, i) => {
            html += `
                <div class="pu-mtt-wc-item">
                    <input type="checkbox"
                           id="wc-${wc.name}"
                           data-testid="pu-mtt-wc-${wc.name}"
                           ${wc.checked ? 'checked' : ''}
                           ${wc.shared ? 'disabled' : ''}>
                    <label for="wc-${wc.name}">
                        <span class="pu-mtt-wc-name">${wc.name}</span>
                        <span class="pu-mtt-wc-count">(${wc.count} values)</span>
                        ${wc.shared ? '<span class="pu-mtt-wc-shared">stays local</span>' : ''}
                    </label>
                </div>
            `;
        });
        html += `</div>`;

        // Warning for shared wildcards
        if (data.hasWarnings) {
            const sharedNames = data.wildcards.filter(w => w.shared).map(w => w.name);
            html += `
                <div class="pu-export-validation-item warning" data-testid="pu-mtt-shared-warning">
                    <span>&#9888;</span>
                    <span>${sharedNames.map(n => `<strong>${n}</strong>`).join(', ')} also used in other blocks &mdash; will stay local</span>
                </div>
            `;
        }

        html += `</div>`;
    }

    body.innerHTML = html;
}

function toggleWildcards() {
    wcExpanded = !wcExpanded;
    const list = document.getElementById('wc-list');
    const chevron = document.getElementById('wc-chevron');
    if (list) list.style.display = wcExpanded ? 'block' : 'none';
    if (chevron) chevron.classList.toggle('expanded', wcExpanded);
}

function updatePathHint() {
    const input = document.getElementById('mtt-theme-name');
    const hint = document.getElementById('path-hint');
    const sharedVal = document.getElementById('shared-path-val');
    const forkVal = document.getElementById('fork-path-val');
    const scope = document.querySelector('input[name="move-scope"]:checked');

    if (!input || !hint) return;
    const val = input.value || '';

    if (sharedVal) sharedVal.textContent = val;
    if (forkVal) forkVal.textContent = val;

    if (scope && scope.value === 'fork') {
        const data = scenarios[currentScenario];
        hint.textContent = `ext/${data ? data.jobId : 'job'}/${val}`;
    } else {
        hint.textContent = `ext/${val}`;
    }
}

function simulateMove() {
    closeModal();
    const input = document.getElementById('mtt-theme-name');
    const scope = document.querySelector('input[name="move-scope"]:checked');
    const data = scenarios[currentScenario];

    let path;
    if (scope && scope.value === 'fork') {
        path = `ext/${data.jobId}/${input ? input.value : ''}`;
    } else {
        path = `ext/${input ? input.value : ''}`;
    }

    showToast(`Moved to ${path}.yaml`, 'success');
}

function showToast(message, type) {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `pu-toast ${type}`;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

// Close modal on overlay click
document.getElementById('modal-overlay').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
});

// Open happy path by default after short delay
setTimeout(() => openModal('happy'), 300);
</script>

</body>
</html>
